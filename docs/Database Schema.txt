

# 数据结构说明（Database Schema）

> 本文档定义系统的**逻辑数据结构与关系模型**。  
>  
> - 不绑定具体数据库（PostgreSQL / SQLite 等）  
> - 不绑定 ORM（Prisma / Drizzle / TypeORM）  
> - 必须遵守 `domain-model.md` 与 `api-spec.md`  

---

## 1. 文档定位

### 1.1 本文档负责

- 定义核心表及其关系
- 明确字段的**业务语义**
- 作为数据库设计与 AI 生成 schema 的依据

### 1.2 本文档不负责

- 索引调优细节
- 分库分表策略
- 数据迁移方案

---

## 2. 设计原则

- ✅ 数据结构服务于 **任务管理**
- ✅ 克制字段设计，避免“为未来过度建模”
- ✅ 字段语义明确，避免一字段多含义
- ❌ 不在 schema 层表达业务规则（如权限）

---

## 3. 核心表结构

### 3.1 User

> 表示系统中的真实用户

| 字段 | 说明 |
|---|---|
| id | 用户唯一标识 |
| createdAt | 创建时间 |

**说明：**
- 不在此层存储认证信息
- 用户属性扩展应谨慎

---

### 3.2 Group

> 表示任务的组织空间

| 字段 | 说明 |
|---|---|
| id | 群组唯一标识 |
| name | 群组名称 |
| createdAt | 创建时间 |

**约束：**
- Group 是 Task 的唯一归属单位

---

### 3.3 GroupMember

> 表示 User 与 Group 的成员关系

| 字段 | 说明 |
|---|---|
| id | 记录唯一标识 |
| userId | 用户 |
| groupId | 群组 |
| joinedAt | 加入时间 |

**说明：**
- 是否管理员等角色信息不在当前阶段建模

---

### 3.4 Task

> 表示一件**具体、可完成的任务实例**

| 字段 | 说明 |
|---|---|
| id | 任务唯一标识 |
| groupId | 所属群组 |
| createdBy | 创建任务的 User |
| title | 任务标题 |
| status | 状态（pending / completed） |
| targetDate | 关联日期（可选） |
| createdAt | 创建时间 |
| completedAt | 完成时间（可选） |

#### 关于 `targetDate`（重要说明）

- ✅ 表示“这件事主要与哪一天相关”
- ✅ 用于排序、筛选、今日任务
- ❌ **不表示截止时间**
- ❌ **不用于自动生成任务**

> 在“偏任务管理”的模型中，  
> **重复行为应通过多个 Task 实例表达，而不是规则字段。**

---

### 3.5 Device

> 表示展示设备（只读业务数据）

| 字段 | 说明 |
|---|---|
| id | 设备唯一标识 |
| groupId | 绑定的 Group |
| status | online / offline |
| lastSeenAt | 最近心跳时间 |
| createdAt | 注册时间 |

**约束：**
- 一个 Device 只能绑定一个 Group
- 一个 Group 最多绑定一个 Device

---

## 4. 表关系总览（文字版）

- User ⟶ GroupMember ⟶ Group  
- Group ⟶ Task  
- User ⟶ Task（createdBy）  
- Group ⟶ Device（最多一个）

---

## 5. 删除与历史策略（概念级）

- Task 完成后：
  - ✅ 保留记录
  - ✅ 可用于历史查看
- 是否清理历史数据：
  - 不在 schema 层决定
  - 由业务或运维策略控制

---

## 6. 未来扩展指引（非实现）

以下能力**不在当前 schema 中实现**，但 schema 不应阻碍：

- Task 标签 / 分类
- Task 附加说明
- 自动生成 Task（AI / 模板）

若引入，应新增表或字段，  
**不得复用 `targetDate` 表达新语义。**

---

## 7. 对 AI 的约束（重要）

当 AI 基于本文档生成数据库结构时：

- ✅ 必须保留字段语义
- ❌ 不得将 `targetDate` 当作 `dueAt`
- ❌ 不得引入 recurrence / rule 表

---

## 8. 维护原则

- 表结构变更应同步更新本文档
- 字段语义变化必须显式说明
- 本文档应长期保持“可读而稳定”

---

