

# 技术决策记录（Technical Decisions）

> 本文档记录系统在早期阶段做出的**关键技术与建模决策**，  
> 用于解释「**为什么系统被设计成现在这个样子**」。  
>  
> - 本文档不重复 API / Schema 细节  
> - 本文档不描述具体实现  
> - 当未来做出相反决策时，应更新或补充本文档  

---

## 1. 文档目的

- 记录**不可逆或高成本变更**的技术选择
- 避免未来反复讨论已经想清楚的问题
- 为 AI 生成代码或设计提供“背景约束”

---

## 2. 产品与系统定位决策

### TD-01：系统定位为「偏任务管理」

**决策：**
- 系统核心目标是管理**具体、可完成的任务**
- 而不是建模长期行为、习惯或家庭节律

**原因：**
- 降低模型复杂度
- 避免过早引入规则系统
- 更贴近早期真实使用场景

**影响：**
- Task 被视为一次性实例
- “每天早读”表现为每天创建的 Task
- 不引入 recurrence / rule 等概念

---

## 3. Task 模型相关决策

### TD-02：Task 不等于行为规则

**决策：**
- Task 表示“一件要完成的事”
- 不表示“长期重复的行为模式”

**原因：**
- 行为规则与任务实例在语义上不同
- 混合建模会导致字段语义混乱

**影响：**
- 重复行为通过多个 Task 实例体现
- 自动生成 Task 被视为未来能力，而非当前模型基础

---

### TD-03：不引入强语义的截止时间（dueAt）

**决策：**
- Task 不包含强约束的截止时间字段
- 仅允许使用弱语义的时间关联字段（如 `targetDate`）

**原因：**
- 截止时间不适用于所有任务类型
- 容易被误用为业务规则驱动点

**影响：**
- 时间字段仅用于排序、筛选、聚焦
- 不用于自动完成、过期判断或生成逻辑

---

## 4. Device 相关决策

### TD-04：Device 是外部只读展示系统

**决策：**
- Device 不参与任何业务数据写入
- Device 不能代表 User 执行操作

**原因：**
- 简化安全模型
- 明确责任边界
- 降低硬件接入复杂度

**影响：**
- 所有 Task 变更必须由 User 触发
- Device 仅接收 Group 状态的投影数据

---

### TD-05：一 Device 绑定一 Group

**决策：**
- 一个 Device 只能绑定一个 Group
- 一个 Group 最多绑定一个 Device

**原因：**
- 展示语义清晰
- 避免权限与数据混淆

**影响：**
- Device 逻辑简单
- 未来如需支持多设备，应新增模型而非复用

---

## 5. API 与数据层边界决策

### TD-06：API 是语义契约，而非实现暴露

**决策：**
- API 不直接反映数据库结构
- API 返回的是业务语义对象

**原因：**
- 允许内部重构
- 避免前端或 Device 依赖内部实现

**影响：**
- Schema 与 API 可独立演进
- AI 生成代码必须以 API 语义为准

---

### TD-07：Schema 克制设计，避免未来锁死

**决策：**
- 不为“可能的未来功能”预建表或字段
- 扩展通过新增结构完成，而非复用旧字段

**原因：**
- 过早建模未来通常是错误建模
- 清晰的扩展比“看似灵活”的字段更安全

**影响：**
- Schema 简单、可读
- 任何新增能力都需要明确决策记录

---

## 6. 对 AI 的全局约束

当 AI 基于本项目生成代码、设计或文档时：

- ✅ 必须遵守本文档中的技术取舍
- ❌ 不得自动引入 recurring / rule / cron 模型
- ❌ 不得将弱语义字段升级为业务规则

---

## 7. 维护原则

- 每一条决策都应有明确编号
- 当决策被推翻时：
  - 不删除旧决策
  - 新增决策说明原因与影响
- 本文档是**解释系统演进的时间线**

---

