

# 文档使用与开发协议（Documentation Guide）

> 本文档定义**如何正确地使用、遵守和更新项目中的文档**。  
>  
> 它是连接「设计文档」与「实际开发行为」的**协议层**，  
> 适用于 **人类开发者** 与 **AI 协作者**。

---

## 1. 文档体系总览

### 1.1 文档分层与职责

| 文档 | 职责 |
|---|---|
| prd.md | 产品目标与范围 |
| domain-model.md | 业务世界观与核心概念 |
| technical-decisions.md | 关键技术与建模取舍的原因 |
| api-spec.md | 对外业务接口语义 |
| database-schema.md | 数据结构与字段语义 |
| device-integration.md | Device 的能力与边界 |
| deployment.md | 系统运行与部署边界 |
| project-structure.md | 代码与协作结构 |
| **documentation-guide.md** | **文档如何被使用与维护** |

---

### 1.2 强约束 vs 参考文档

- **强约束文档**（必须遵守）：
  - domain-model.md
  - technical-decisions.md
  - api-spec.md
  - database-schema.md
  - device-integration.md

- **参考与执行层文档**：
  - deployment.md
  - project-structure.md
  - README.md

---

## 2. 开发时的阅读顺序（非常重要）

当你准备**实现或修改任何功能**时，推荐的阅读顺序是：

1. **domain-model.md**  
   → 是否引入了新概念？是否改变了已有语义？

2. **technical-decisions.md**  
   → 是否触碰已明确拒绝或延迟的方向？

3. **api-spec.md**  
   → 对外行为是否需要变化？

4. **database-schema.md**  
   → 是否真的需要改结构，还是实现层问题？

5. **project-structure.md**  
   → 代码应放在哪里？是否越界？

---

## 3. 常见开发场景指引

### 3.1 新增一个功能

请依次判断：

- 是否引入了新业务概念？
  - ✅ 是 → 更新 `domain-model.md`
- 是否改变了系统方向或原则？
  - ✅ 是 → 新增一条 `technical-decisions.md`
- 是否影响 API 行为？
  - ✅ 是 → 更新 `api-spec.md`
- 是否只是实现细节？
  - ✅ 是 → **只改代码**

---

### 3.2 修改 Task 的行为或字段

必须先问三个问题：

1. 是否改变 Task 的**语义**？
   - ✅ 是 → domain-model.md
2. 是否违反“偏任务管理”的既有取舍？
   - ✅ 是 → technical-decisions.md
3. 是否只是展示或排序方式变化？
   - ✅ 是 → 不改文档

> **禁止**在未更新文档的情况下，  
> 悄悄将 `targetDate` 当作截止时间使用。

---

### 3.3 修改数据库结构

- 不允许：
  - 复用字段表达新语义
  - 为“可能的未来”提前加字段
- 允许：
  - 新增明确语义的新字段
  - 新增表以承载新能力

任何结构变更：
- ✅ 必须同步更新 `database-schema.md`

---

### 3.4 接入新的 Device 或展示终端

必须遵守：

- Device 只读
- Device 不代表 User
- Device 不写业务数据

如有例外：
- ✅ 必须先更新 `technical-decisions.md`
- ❌ 不能只在实现层“特殊处理”

---

## 4. 什么时候**必须**更新文档？

| 变化类型 | 是否必须更新文档 |
|---|---|
| 新业务概念 | ✅ 是 |
| Task 语义变化 | ✅ 是 |
| API 对外行为变化 | ✅ 是 |
| 数据字段含义变化 | ✅ 是 |
| 纯实现重构 | ❌ 否 |
| 性能优化 | ❌ 否 |

---

## 5. 对 AI 的使用协议（强约束）

当 AI 参与开发时，必须遵守以下规则：

### 5.1 AI 的输入优先级

1. documentation-guide.md  
2. technical-decisions.md  
3. domain-model.md  
4. api-spec.md  
5. database-schema.md  

---

### 5.2 AI **可以做的事**

- 根据现有文档生成代码
- 在不改变语义的前提下重构实现
- 提出变更建议（但不自动执行）

---

### 5.3 AI **禁止做的事**

- ❌ 引入 recurrence / rule / cron 模型
- ❌ 自动新增 dueAt / deadline 等强语义字段
- ❌ 改变 Task / Device 的基本角色
- ❌ 在未更新文档的情况下修改语义

---

## 6. 文档更新原则

- 文档优先于代码
- 文档与代码冲突时：
  - 先修正认知
  - 再修正实现
- 不确定是否该改文档时：
  - **宁可写下来，也不要省略**

---

## 7. 本文档的地位

- 本文档是**元文档**
- 用于约束：
  - 人
  - AI
  - 未来的自己
- 当文档体系发生变化时：
  - 本文档应最先更新

---

